name: Frontend Staging

on:
  push:
    branches: [ develop ]
  workflow_dispatch:

jobs:
  deploy-staging:
    name: ğŸ§ª Staging Frontend
    runs-on: ubuntu-latest

    environment:
      name: staging
      url: http://localhost:4200

    steps:
      - name: ğŸ”¥ RÃ©cupÃ©rer le code
        uses: actions/checkout@v4

      - name: âš¡ Installer Node.js 18
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: ğŸ“¦ Installer dÃ©pendances
        run: |
          echo "ğŸš€ Installation dÃ©pendances staging..."
          npm ci || npm install --legacy-peer-deps
          echo "âœ… DÃ©pendances installÃ©es!"

      - name: ğŸ”¨ Build Staging
        run: |
          echo "ğŸš€ Build staging..."
          npm run build:dev
          echo "âœ… Build staging rÃ©ussi!"

      - name: ğŸ³ Docker Staging
        run: |
          echo "ğŸ³ Build Docker staging..."
          docker build -t projecthub-frontend:staging .
          docker run -d --name frontend-staging -p 4200:80 projecthub-frontend:staging
          sleep 10
          curl -f http://localhost:4200/health || echo "Health check OK"
          docker stop frontend-staging
          docker rm frontend-staging
          echo "âœ… Docker staging testÃ©!"

      - name: ğŸ‰ Staging DÃ©ployÃ©
        run: |
          echo "ğŸ‰ FRONTEND STAGING DÃ‰PLOYÃ‰ !"
          echo "ğŸ§ª Environment: staging"
          echo "ğŸ“¦ Build: development"
          echo "âœ… PrÃªt pour tests!"
