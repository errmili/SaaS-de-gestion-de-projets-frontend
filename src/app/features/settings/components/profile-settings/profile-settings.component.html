<div class="profile-settings-container">
  <h2>Profile Information</h2>
  <p class="section-description">Update your personal information and avatar</p>

  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
  </div>

  <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" *ngIf="!isLoading">
    <!-- Avatar Section -->
    <div class="avatar-section">
      <div class="avatar-preview">
        <img [src]="getAvatarUrl()"
             alt="Profile avatar"
             class="avatar-image">
      </div>
      <div class="avatar-info">
        <h3>Profile Picture</h3>
        <p>Enter an image URL for your avatar</p>
      </div>
    </div>

    <!-- Avatar URL Field -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Avatar URL</mat-label>
      <mat-icon matPrefix>link</mat-icon>
      <input matInput
             formControlName="avatarUrl"
             placeholder="https://example.com/avatar.jpg">
      <mat-hint>Optional - Leave empty for default avatar</mat-hint>
      <mat-error *ngIf="profileForm.get('avatarUrl')?.hasError('maxlength')">
        URL is too long (max 500 characters)
      </mat-error>
    </mat-form-field>

    <!-- Name Fields -->
    <div class="form-row">
      <mat-form-field appearance="outline">
        <mat-label>First Name</mat-label>
        <mat-icon matPrefix>person</mat-icon>
        <input matInput
               formControlName="firstName"
               placeholder="John">
        <mat-error *ngIf="profileForm.get('firstName')?.hasError('required')">
          First name is required
        </mat-error>
        <mat-error *ngIf="profileForm.get('firstName')?.hasError('maxlength')">
          First name is too long
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Last Name</mat-label>
        <mat-icon matPrefix>person</mat-icon>
        <input matInput
               formControlName="lastName"
               placeholder="Doe">
        <mat-error *ngIf="profileForm.get('lastName')?.hasError('required')">
          Last name is required
        </mat-error>
        <mat-error *ngIf="profileForm.get('lastName')?.hasError('maxlength')">
          Last name is too long
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Email (Read-only) -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Email</mat-label>
      <mat-icon matPrefix>email</mat-icon>
      <input matInput
             [value]="currentUser?.email"
             readonly>
      <mat-hint>Email cannot be changed</mat-hint>
    </mat-form-field>

    <!-- Actions -->
    <div class="form-actions">
      <button mat-button
              type="button"
              (click)="onCancel()"
              [disabled]="isSaving">
        Cancel
      </button>
      <button mat-raised-button
              color="primary"
              type="submit"
              [disabled]="profileForm.invalid || isSaving">
        <mat-spinner *ngIf="isSaving" diameter="20"></mat-spinner>
        <span *ngIf="!isSaving">Save Changes</span>
      </button>
    </div>
  </form>
</div>
