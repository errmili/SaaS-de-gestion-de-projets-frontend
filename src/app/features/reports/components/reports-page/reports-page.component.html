<div class="reports-page-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <h1>Reports & Analytics</h1>
      <p>Insights and statistics for your projects</p>
    </div>
    <div class="header-actions">
      <button mat-icon-button
              (click)="refreshData()"
              matTooltip="Refresh"
              [disabled]="isLoading">
        <mat-icon>refresh</mat-icon>
      </button>
      <button mat-stroked-button
              (click)="exportReport()"
              [disabled]="isLoading">
        <mat-icon>file_download</mat-icon>
        Export Report
      </button>
    </div>
  </div>

  <!-- Filters -->
  <mat-card class="filters-card">
    <div class="filters-content">
      <mat-form-field appearance="outline">
        <mat-label>Time Period</mat-label>
        <mat-icon matPrefix>date_range</mat-icon>
        <mat-select [formControl]="selectedPeriod">
          <mat-option *ngFor="let period of periods" [value]="period.value">
            {{ period.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Project</mat-label>
        <mat-icon matPrefix>folder</mat-icon>
        <mat-select [formControl]="selectedProjectId">
          <mat-option value="all">All Projects</mat-option>
          <mat-option *ngFor="let project of allProjects" [value]="project.id">
            {{ project.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </mat-card>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Loading reports...</p>
  </div>

  <!-- Content -->
  <div *ngIf="!isLoading" class="reports-content">

    <!-- Key Metrics -->
    <div class="metrics-section">
      <h2>Key Metrics</h2>
      <div class="metrics-grid">
        <mat-card class="metric-card">
          <div class="metric-icon completion">
            <mat-icon>check_circle</mat-icon>
          </div>
          <div class="metric-content">
            <div class="metric-value">{{ completionRate }}%</div>
            <div class="metric-label">Completion Rate</div>
          </div>
        </mat-card>

        <mat-card class="metric-card">
          <div class="metric-icon tasks">
            <mat-icon>assignment</mat-icon>
          </div>
          <div class="metric-content">
            <div class="metric-value">{{ dashboardData?.stats?.totalTasks || 0 }}</div>
            <div class="metric-label">Total Tasks</div>
          </div>
        </mat-card>

        <mat-card class="metric-card">
          <div class="metric-icon average">
            <mat-icon>analytics</mat-icon>
          </div>
          <div class="metric-content">
            <div class="metric-value">{{ avgTasksPerProject }}</div>
            <div class="metric-label">Avg Tasks/Project</div>
          </div>
        </mat-card>

        <mat-card class="metric-card">
          <div class="metric-icon overdue">
            <mat-icon>warning</mat-icon>
          </div>
          <div class="metric-content">
            <div class="metric-value">{{ overdueTasks }}</div>
            <div class="metric-label">Overdue Tasks</div>
          </div>
        </mat-card>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      <h2>Task Distribution</h2>
      <div class="charts-grid">
        <!-- Status Chart -->
        <mat-card class="chart-card">
          <mat-card-header>
            <mat-card-title>By Status</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <app-task-distribution-chart
              *ngIf="statusChartData"
              [data]="statusChartData"
              [type]="'doughnut'">
            </app-task-distribution-chart>
          </mat-card-content>
        </mat-card>

        <!-- Priority Chart -->
        <mat-card class="chart-card">
          <mat-card-header>
            <mat-card-title>By Priority</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <app-task-distribution-chart
              *ngIf="priorityChartData"
              [data]="priorityChartData"
              [type]="'pie'">
            </app-task-distribution-chart>
          </mat-card-content>
        </mat-card>

        <!-- Type Chart -->
        <mat-card class="chart-card">
          <mat-card-header>
            <mat-card-title>By Type</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <app-task-distribution-chart
              *ngIf="typeChartData"
              [data]="typeChartData"
              [type]="'bar'">
            </app-task-distribution-chart>
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <!-- Project Stats Table -->
    <div class="table-section">
      <h2>Project Statistics</h2>
      <app-project-stats-table
        [projects]="allProjects"
        [tasks]="allTasks">
      </app-project-stats-table>
    </div>

  </div>
</div>
